-- Eliminar la base de datos existente si existe
DROP DATABASE IF EXISTS AltaDisponibilidadDB_Main;

-- Crear base de datos
CREATE DATABASE AltaDisponibilidadDB_Main;
USE AltaDisponibilidadDB_Main;

-- Crear tabla Usuarios
CREATE TABLE Usuarios (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    Username VARCHAR(15) NOT NULL,
    Password VARCHAR(25) NOT NULL,
    Email VARCHAR(50) NOT NULL UNIQUE,
    Nombre VARCHAR(20),
    Apellido VARCHAR(20),
    CreadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ActualizadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Crear tabla Disponibilidad
CREATE TABLE Disponibilidad (
    LogID INT PRIMARY KEY AUTO_INCREMENT,
    Estado VARCHAR(20) NOT NULL
);

-- Insertar datos de ejemplo en la tabla Disponibilidad
INSERT INTO Disponibilidad (Estado) VALUES
('Disponible'),
('No Disponible'),
('Mantenimiento');

-- Crear tabla Carros
CREATE TABLE Carros (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    Marca VARCHAR(50) NOT NULL,
    Modelo VARCHAR(50) NOT NULL,
    Placa VARCHAR(20) NOT NULL UNIQUE,
    id_disponibilidad INT,
    ImagenURL VARCHAR(255),
    DetalleEstado TEXT,
    IngresadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ActualizadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_disponibilidad) REFERENCES Disponibilidad(LogID) ON DELETE SET NULL
);

-- Crear tabla Rentas con relaciones
CREATE TABLE Rentas (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    id_usuario INT NOT NULL,
    id_carro INT NOT NULL,
    ComienzoRenta TIMESTAMP NOT NULL,
    FinalRenta TIMESTAMP,
    CostoTotal DECIMAL(10, 2),
    CreadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ActualizadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(ID) ON DELETE CASCADE,
    FOREIGN KEY (id_carro) REFERENCES Carros(ID) ON DELETE CASCADE
);

-- Crear tabla ServicioCliente con relaciones
CREATE TABLE ServicioCliente (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    id_usuario INT NOT NULL,
    id_carro INT,
    TipoIncidencia VARCHAR(20) NOT NULL,
    Descripcion TEXT NOT NULL,
    CreadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ActualizadoEn TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    Resuelto BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(ID) ON DELETE CASCADE,
    FOREIGN KEY (id_carro) REFERENCES Carros(ID) ON DELETE SET NULL
);

-- Insertar datos de ejemplo en la tabla Carros
INSERT INTO Carros (Marca, Modelo, Placa, id_disponibilidad, ImagenURL, DetalleEstado) VALUES
('Toyota', 'Corolla', 'ABC123', 1, 'https://via.placeholder.com/150', 'En buen estado general.'),
('Honda', 'Civic', 'DEF456', 1, 'https://via.placeholder.com/150', 'Cambio de aceite reciente.'),
('Ford', 'Mustang', 'GHI789', 3, 'https://via.placeholder.com/150', 'Neumáticos nuevos.'),
('Chevrolet', 'Cruze', 'JKL012', 1, 'https://via.placeholder.com/150', 'Sin daños.'),
('Hyundai', 'Elantra', 'MNO345', 2, 'https://via.placeholder.com/150', 'Revisión técnica pasada.'),
('Mazda', '3', 'PQR678', 1, 'https://via.placeholder.com/150', 'Interior en excelentes condiciones.'),
('Nissan', 'Altima', 'STU901', 2, 'https://via.placeholder.com/150', 'Cambio de frenos reciente.'),
('Volkswagen', 'Golf', 'VWX234', 3, 'https://via.placeholder.com/150', 'Sin accidentes.'),
('Kia', 'Optima', 'YZA567', 1, 'https://via.placeholder.com/150', 'Aire acondicionado funcionando.'),
('Subaru', 'Impreza', 'BCD890', 1, 'https://via.placeholder.com/150', 'Revisión de motor reciente.');
